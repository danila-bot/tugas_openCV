import cv2
import numpy as np
import os
from google.colab.patches import cv2_imshow

# === 1. Siapkan folder output ===
os.makedirs("output", exist_ok=True)

# === 2. Buat kanvas dasar ===
canvas = np.full((400, 600, 3), 255, dtype=np.uint8)

# === 3. Gambar orang sedang melukis ===
# Kepala
cv2.circle(canvas, (150, 150), 40, (0, 200, 255), -1)
# Badan
cv2.rectangle(canvas, (120, 190), (180, 300), (255, 200, 0), -1)
# Tangan kanan (memegang kuas)
cv2.line(canvas, (180, 200), (260, 160), (0, 0, 0), 5)
cv2.line(canvas, (260, 160), (280, 150), (50, 50, 50), 3)
cv2.circle(canvas, (282, 148), 5, (0, 0, 255), -1)  # ujung kuas
# Tangan kiri
cv2.line(canvas, (120, 200), (80, 240), (0, 0, 0), 5)
# Kaki
cv2.line(canvas, (130, 300), (130, 370), (0, 0, 0), 5)
cv2.line(canvas, (170, 300), (170, 370), (0, 0, 0), 5)
# Kanvas lukis
cv2.rectangle(canvas, (320, 100), (500, 280), (230, 230, 230), -1)
cv2.rectangle(canvas, (320, 100), (500, 280), (0, 0, 0), 2)
# Gambar di kanvas
cv2.circle(canvas, (410, 190), 40, (0, 255, 0), -1)
cv2.putText(canvas, "ART", (370, 270), cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 0, 0), 2)

cv2.putText(canvas, "Pelukis", (100, 50), cv2.FONT_HERSHEY_SIMPLEX, 1, (0, 0, 0), 2)

# Simpan & tampilkan gambar awal
cv2.imwrite("output/pelukis.png", canvas)
cv2_imshow(canvas)


# === 4. Transformasi ===

# a) Translasi (geser gambar)
M_translate = np.float32([[1, 0, 50], [0, 1, 30]])
translated = cv2.warpAffine(canvas, M_translate, (600, 400))
cv2.imwrite("output/pelukis_translasi.png", translated)
cv2_imshow(translated)


# b) Rotasi
center = (300, 200)
M_rotate = cv2.getRotationMatrix2D(center, 25, 1.0)
rotated = cv2.warpAffine(canvas, M_rotate, (600, 400))
cv2.imwrite("output/pelukis_rotasi.png", rotated)
cv2_imshow(rotated)


# c) Resize (ubah ukuran lebih kecil)
resized = cv2.resize(canvas, (300, 200))
cv2.imwrite("output/pelukis_resize.png", resized)
cv2_imshow(resized)


# === 5. Operasi Aritmatika & Bitwise ===

# a) Tambah kecerahan (add)
bright = cv2.add(canvas, np.full_like(canvas, 60))
cv2.imwrite("output/pelukis_bright.png", bright)
cv2_imshow(bright)


# b) Bitwise gabung dengan background warna biru muda
background = np.full((400, 600, 3), (255, 200, 150), dtype=np.uint8)
mask = cv2.cvtColor(canvas, cv2.COLOR_BGR2GRAY)
_, mask_bin = cv2.threshold(mask, 50, 255, cv2.THRESH_BINARY)
mask_inv = cv2.bitwise_not(mask_bin)

fg = cv2.bitwise_and(canvas, canvas, mask=mask_bin)
bg = cv2.bitwise_and(background, background, mask=mask_inv)
combined = cv2.add(fg, bg)

cv2.imwrite("output/pelukis_bitwise.png", combined)
cv2_imshow(combined)

print(" Semua tahap selesai! Hasil disimpan di folder 'output/'.")
